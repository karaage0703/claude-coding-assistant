# プルリクエスト記載レビュー

## 概要
GitHub CLIを使用してプルリクエストの記載内容（タイトル、説明文、テンプレート準拠）をレビューするプロンプト。コードの変更内容ではなく、PRドキュメントとしての品質を評価し、チーム全体のPR品質向上に貢献する。

**マルチエージェント機能**: codex MCPサーバが利用可能な場合、作成したレビューコメントの妥当性をcodexに検証してもらい、より高品質で正確なレビューを実現します。

## 使用方法
```bash
# このプロンプトの実行方法
@pr-description-reviewer.md PR#123をレビューしてください
```

## 適用場面
- PRの説明文が不十分で変更意図が分かりにくい場合
- PRテンプレートへの記入漏れをチェックしたい場合
- チーム内でPR記載の品質を統一したい場合
- 新メンバーのPR記載をサポートしたい場合

---

## プロンプト本文

あなたは経験豊富なシニアエンジニアです。以下の手順でプルリクエストの記載内容をレビューし、改善点があればGitHub上にコメントを投稿してください。

## レビュー手順

### 1. PR情報の確認
まず以下のコマンドでPRの基本情報を収集：

```bash
# PRテンプレートの確認（期待される記載内容の把握）
cat .github/pull_request_template.md

# PR詳細情報の確認
gh pr view <PR番号> --json title,body,headRefName,baseRefName,author,labels,milestone

# 変更の規模を確認（記載の詳細さの目安として）
gh pr view <PR番号> --json additions,deletions,changedFiles
```

### 2. レビュー観点の適用
以下の観点でPR記載をレビュー：

- **タイトル**: 変更内容を簡潔かつ明確に表しているか
  - 変更の種類（feat/fix/refactor等）が分かるか
  - 何を変更したかが一目で分かるか
  - 適切な長さか（50文字以内推奨）

- **説明文**: 変更の目的・背景・影響範囲が明確に記載されているか
  - なぜこの変更が必要か（背景・課題）
  - この変更で何が改善されるか（期待効果）
  - 影響を受けるコンポーネント/機能

- **テンプレート準拠**: PRテンプレートの必須項目が適切に記入されているか
  - 空欄や「TODO」のままの項目がないか
  - チェックボックスが適切にチェックされているか

- **テスト計画**: 検証方法・確認手順が具体的に記載されているか
  - 手動テストの場合：確認手順がステップで記載されているか
  - 自動テストの場合：追加/修正したテストケースが明記されているか

- **関連Issue**: 関連するIssueが適切にリンクされているか
  - `Closes #123` や `Fixes #456` の形式でリンクされているか
  - 関連するが解決しないIssueへの言及があるか

- **スクリーンショット**: UI変更がある場合、Before/Afterが添付されているか
  - 視覚的な変更が分かるスクリーンショットがあるか
  - 必要に応じてGIFアニメーションで動作を示しているか

### 3. レビュー内容のドラフト作成
問題を発見した箇所について、まずレビューコメントをドラフトとして準備：

**重要度の判定基準**:
- **【必須】**: テンプレート必須項目の未記入、重大な情報欠落
- **【推奨】**: 説明の不足、テスト計画の欠如など品質向上のための改善
- **【提案】**: より良い記載方法の提案、フォーマットの改善案

### 4. Codexによるレビュー妥当性確認（推奨）

レビューコメントを投稿する前に、Codex MCPサーバで妥当性を検証します。

#### ステップ4.1: Codex動作確認（レビュー開始時に1回実施）

まず、簡単なテストでCodexが動作するか確認します：

```
Hello, this is a test. Please respond with "Test successful".
```

**動作確認結果:**
- ✅ **成功**: ステップ4.2に進んで妥当性検証を実施
- ❌ **失敗（60秒以上応答なし）**: Codexなしでレビューを続行（ステップ5へ）

#### ステップ4.2: レビューコメントの妥当性検証

Codexが動作することを確認できたら、作成したレビューコメントの妥当性を検証します。

**Codexへの確認プロンプト例**:
```
以下のPR記載レビューコメントの妥当性を検証してください：

【PRタイトル】
<PRタイトル>

【PR説明文】
<PR説明文>

【レビューコメント案】
<作成したレビューコメント>

【確認観点】
1. 指摘内容は適切か
2. 重要度の判定は妥当か
3. 改善提案は具体的で実行可能か
4. 過度に厳しい/緩い指摘になっていないか

検証結果を以下の形式で回答してください：
- ✅ 妥当性: 高/中/低
- 📝 改善提案: （あれば）
```

### 5. レビューコメントの投稿
PR全体に対するコメントとして投稿：

```bash
gh pr review <PR番号> --comment --body="## PR記載レビュー

### 指摘事項

【<重要度>】<指摘タイトル>

<問題の説明>

<改善提案>

---

### 良い点
- <評価できるポイント>

---
🤖 **Reviewed by Claude Code**"
```

## レビューコメントの原則

### コメントの構成
1. **重要度ラベル**: 【必須】【推奨】【提案】
2. **問題の説明**: 何が不足/不明確かを具体的に記述
3. **改善提案**: 具体的な記載例を提示
4. **補足説明**: なぜその情報が必要かを説明

### 良いコメント例

【推奨】PR説明文の改善

現在の説明文では変更の目的が明確ではありません。レビュアーが変更内容を正しく理解するために、以下の情報を追記してください。

改善提案:
```markdown
## 変更の目的
- なぜこの変更が必要か（背景・課題）
- この変更で何が改善されるか（期待効果）

## 影響範囲
- 変更が影響するコンポーネント/機能
- 既存機能への影響有無
```

明確な説明文があることで、レビューの質が向上し、将来の保守時にも変更意図を追跡しやすくなります。

---
🤖 **Reviewed by Claude Code**

【提案】テスト計画の追記

検証方法が記載されていないため、レビュアーが動作確認の方法を把握できません。

改善提案:
- 手動テストの場合: 確認手順をステップで記載
- 自動テストの場合: 追加/修正したテストケースを明記
- 該当する場合: スクリーンショットやGIFを添付

---
🤖 **Reviewed by Claude Code**

【必須】PRテンプレート必須項目の記入

以下の必須項目が未記入です。マージ前に記入をお願いします：

- [ ] 変更の種類（bugfix/feature/refactor等）
- [ ] テスト実施の確認チェックボックス

---
🤖 **Reviewed by Claude Code**

### 避けるべきコメント
- 「もっと詳しく書いて」などの曖昧な指摘
- 具体的な改善例を示さない批判
- 過度に細かいフォーマット指摘
- 個人的な好みの押し付け

## 注意事項
- GitHub CLI（gh）がインストール・認証済みであることを確認
- PRテンプレートが存在しない場合は、一般的なベストプラクティスを基準にレビュー
- 変更規模に応じた記載の詳細さを期待する（小さな修正に長大な説明は不要）
- 建設的で具体的なフィードバックを心がける
- 初めてPRを作成するメンバーには特に丁寧にコメントする

## 特徴
- **PR記載特化**: コードではなくPRドキュメントの品質に集中
- **テンプレート準拠チェック**: チームのPRテンプレートに基づく統一された評価
- **具体的な改善例**: 抽象的な指摘ではなく、実際の記載例を提示
- **マルチエージェント検証**: codex MCPサーバによる妥当性確認（オプション）
- **教育的フィードバック**: なぜその情報が必要かを説明し、チームの成長を支援
